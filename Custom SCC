How to Apply Custom SCC in OpenShift NameSpace

Steps:

1. Create a SCC
2. Create Service Account in your namespaces
3. Associate Service Account with custom SCC
4. Update Deployment Config / Deployment to run container with the Service Account created
5. Rollout latest for Deployment Config or scale doen/up for Deployment 

Sample SCC for CDB test 

cdb-scc.yaml

kind: SecurityContextConstraints
apiVersion: v1
fsGroup:
  type: MustRunAs
groups: []
metadata:
  annotations:
    kubernetes.io/description: SCC for CDB
  name: cdb
priority: null
readOnlyRootFilesystem: false
requiredDropCapabilities: null
runAsUser:
  type: MustRunAsNonRoot
seLinuxContext:
  type: MustRunAs
supplementalGroups:
  type: MustRunAs
volumes:
- configMap
- downwardAPI
- emptyDir
- nfs
- persistentVolumeClaim
- secret
allowHostDirVolumePlugin: false
allowHostIPC: false
allowHostNetwork: false
allowHostPID: false
allowHostPorts: false
allowPrivilegedContainer: false
allowedCapabilities: []
allowedFlexVolumes: []
defaultAddCapabilities: []

Apply the YAML 

  oc create -f cdb-scc.yaml
  oc get scc

Create a Service Account for the namespaces

  oc create sa cdb-test

Add the Service Account to the SCC (Any of the command we can use)

  oc adm policy add-scc-to-user cdb -z default -n nfs-test
  oc adm policy add-scc-to-user cdb system:serviceaccount:nfs-test:cdb-test

Update Deployment Config to Add Service Account and Run As runAsUser (securityContext, serviceAccountName)

      dnsPolicy: Default
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        runAsUser: 7077405
      serviceAccount: cdb-test
      serviceAccountName: cdb-test
      terminationGracePeriodSeconds: 30


Rollout latest for Deployment Config or scale doen/up for Deployment 

  oc rollout latest dc/<dc_name>
  oc scale --replicas=0 deploy <deploy_name>
  oc scale --replicas=1 deploy <deploy_name>






